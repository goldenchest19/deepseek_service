# Resume-Vacancy Matcher API

API для сопоставления резюме кандидатов с вакансиями работодателей.

## Возможности

- Сопоставление резюме с вакансиями
- Извлечение текста из PDF-файлов резюме
- Нормализация резюме с использованием DeepSeek AI
- Сохранение резюме и нормализованных данных в PostgreSQL
- Получение списка резюме пользователя
- Получение нормализованных данных резюме

## Требования

- Python 3.8+
- PostgreSQL 12+
- DeepSeek API ключ

## Установка

1. Клонировать репозиторий
2. Установить зависимости:

```bash
pip install -r requirements.txt
```

3. Создать файл `.env` со следующими параметрами:

```
# Настройки сервера
SERVER_HOST=0.0.0.0
SERVER_PORT=8000

# API языковой модели
LLM_API_URL=https://api.deepseek.com/v1/chat/completions
LLM_API_KEY=your_api_key_here
LLM_MODEL=deepseek-ai/DeepSeek-V3

# База данных PostgreSQL
DB_HOST=localhost
DB_PORT=5433
DB_NAME=postgres
DB_SCHEMA=resume_db
DB_USER=postgres
DB_PASSWORD=postgres
```

## Запуск

```bash
python run.py
```

При запуске приложения:
1. Автоматически проверяется подключение к базе данных
2. Создается схема `resume_db`, если она не существует
3. Создаются необходимые таблицы в схеме
4. Запускается веб-сервер FastAPI

Если вы хотите только инициализировать базу данных без запуска сервиса, выполните:

```bash
python db_init.py
```

## API Endpoints

### Загрузка и нормализация резюме

`POST /upload-resume`

Загружает PDF-файл резюме, извлекает текст, нормализует его с помощью DeepSeek и сохраняет в базу данных.

**Формат нормализованных данных:**

```json
{
  "name": "ФИО пользователя",
  "email": "email пользователя",
  "phone": "номер телефона",
  "vacancy_name": "Желаемая должность (например, Java Developer)",
  "languages": "Языки разработки",
  "frameworks": "Фреймворки",
  "education": [
    {
      "degree": "степень образования",
      "direction": "направление образования",
      "specialty": "специальность образования"
    }
  ],
  "work_experience": [
    {
      "start_date": "дата начало работы",
      "end_date": "дата окончания работы",
      "company_name": "Название компании",
      "achievements": [
        "Достижение1",
        "Достижение2"
      ],
      "technologies": [
        "technology1",
        "technology2"
      ]
    }
  ]
}
```

### Сопоставление резюме с вакансией

`POST /match`

Сопоставляет текст резюме и вакансии, возвращает совпадения и комментарий от LLM.

### Получение нормализованных данных резюме

`GET /normalized-resume/{resume_id}`

Возвращает нормализованные данные резюме по его ID.

### Другие эндпоинты

- `GET /` - Информация о сервисе
- `POST /match-stored-resume` - Сопоставление загруженного резюме с вакансией
- `GET /resumes/{email}` - Получение списка резюме пользователя

## Структура базы данных

Данные хранятся в схеме `resume_db` в базе данных PostgreSQL.

### Таблица `resume_db.resumes`

Хранит исходные тексты резюме и метаданные:

| Поле | Тип | Описание |
|------|-----|----------|
| id | VARCHAR(36) | Первичный ключ, UUID |
| email | VARCHAR(255) | Email пользователя |
| created_at | TIMESTAMP | Дата и время создания |
| raw_text | TEXT | Исходный текст резюме |
| metadata | JSONB | Метаданные (название файла, автор и др.) |

### Таблица `resume_db.normalized_resumes`

Хранит нормализованные данные резюме:

| Поле | Тип | Описание |
|------|-----|----------|
| id | VARCHAR(36) | Первичный ключ, соответствует ID в таблице resumes |
| name | VARCHAR(255) | ФИО кандидата |
| email | VARCHAR(255) | Email кандидата |
| phone | VARCHAR(100) | Телефон кандидата |
| vacancy_name | VARCHAR(255) | Желаемая должность |
| languages | TEXT | Языки программирования |
| frameworks | TEXT | Фреймворки |
| education | JSONB | Информация об образовании |
| work_experience | JSONB | Информация об опыте работы |
| created_at | TIMESTAMP | Дата и время создания |